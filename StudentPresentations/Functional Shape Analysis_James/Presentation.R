pacman::p_load(fields, fda, ggplot2, cowplot, tidyverse, fdapace, geosphere, shapes, vegan, MASS, caret)

"landx"<-
  structure(.Data = c(-16.5833333333333, -8.66666666666668, -11.3333333333333, 
                      -5.33333333333331, 12.5, -1.5, -35.9166666666667, -17.25, 
                      -1.41666666666669, -25.1666666666667, -4.16666666666669, -5.5, 
                      -20.6666666666667, 16.9166666666667, -15.0833333333333, 
                      -13.9166666666667, -25.9166666666667, -5.16666666666669, 
                      -3.41666666666669, -21.25, -5.41666666666669, -12.3333333333333, 
                      3.83333333333331, -18.0833333333333, 1.66666666666669, 1.83333333333331,
                      -13.9166666666667, -12.6666666666667, -7.66666666666668, 
                      10.4166666666667, -11.25, -9.91666666666668, -9.75, -12, -4.5, 
                      -1.08333333333331, -12.3333333333333, 11.75, -7.5, -11.3333333333333, 
                      -21.0833333333333, -0.833333333333314, -7.66666666666668, 
                      -10.1666666666667, -5, -0.333333333333314, -7.83333333333332, 
                      -22.9166666666667, -13.4166666666667, -5.33333333333331, 
                      5.66666666666668, -8.58333333333332, -20.4166666666667, 
                      -8.08333333333332, -26, -21.8333333333333, -13, -13.25, 7.75, 
                      1.33333333333331, 7.16666666666668, -8.08333333333332, -1.25, 
                      -5.08333333333331, -0.666666666666686, -22.75, -30.75, -43.5, 
                      46.4166666666667, 57.3333333333333, 57.6666666666667, 45.6666666666667, 
                      79.5, 86.5, 47.0833333333333, 44.75, 67.5833333333333, 67.8333333333333,
                      47.8333333333333, 91.5, 42.3333333333333, 99.9166666666667, 
                      71.9166666666667, 67.0833333333333, 63.0833333333333, 43.8333333333333, 
                      27.5833333333333, -120.25, 80.5833333333333, 63.6666666666667, 
                      58.8333333333333, 78.9166666666667, 45.6666666666667, 55.8333333333333, 
                      52.0833333333333, 43.3333333333333, 51.3333333333333, 66.4166666666667, 
                      30.75, 31.0833333333333, 62.25, 56, 68.5, 80.9166666666667, 
                      44.6666666666667, 71.75, 64.5, 63.6666666666667, 55.9166666666667, 
                      58.1666666666667, 53.3333333333333, 45.8333333333333, 75, 
                      64.6666666666667, 64.1666666666667, -121.916666666667, 68.5833333333333,
                      74.6666666666667, 63.6666666666667, 93.4166666666667, 63.5833333333333, 
                      69.9166666666667, 47, 49.1666666666667, 69, 56.75, 83.75, 
                      73.3333333333333, 71.1666666666667, 76.9166666666667, 72.75, 
                      68.9166666666667, 59.3333333333333, 81.25, 59.25, 72.5, 
                      151.416666666667, 170.333333333333, 172.666666666667, 154.666666666667, 
                      184.5, 186.5, 157.083333333333, 169.75, 166.583333333333, 
                      200.833333333333, 155.833333333333, 181.5, 167.333333333333, 
                      205.916666666667, 176.916666666667, 177.083333333333, 197.083333333333, 
                      201.833333333333, 178.583333333333, -174.25, 212.583333333333, 
                      215.666666666667, 192.833333333333, 211.916666666667, 149.666666666667, 
                      148.833333333333, 140.083333333333, 152.333333333333, 203.333333333333, 
                      203.416666666667, 146.75, 162.083333333333, 169.25, 157, 164.5, 
                      184.916666666667, 167.666666666667, 173.75, 189.5, 188.666666666667, 
                      171.916666666667, 160.166666666667, 163.333333333333, 176.833333333333, 
                      194, 165.666666666667, 159.166666666667, -153.916666666667, 
                      180.583333333333, 182.666666666667, 177.666666666667, 187.416666666667, 
                      188.583333333333, 189.916666666667, 155, 153.166666666667, 175, 176.75, 
                      183.75, 178.333333333333, 177.166666666667, 170.916666666667, 168.75, 
                      169.916666666667, 169.333333333333, 190.25, 197.25, 200.5, 
                      180.416666666667, 175.333333333333, 187.666666666667, 189.666666666667, 
                      200.5, 204.5, 191.083333333333, 196.75, 188.583333333333, 
                      233.833333333333, 171.833333333333, 209.5, 207.333333333333, 
                      238.916666666667, 194.916666666667, 192.083333333333, 216.083333333333, 
                      220.833333333333, 224.583333333333, -177.25, 239.583333333333, 
                      244.666666666667, 220.833333333333, 227.916666666667, 164.666666666667, 
                      163.833333333333, 177.083333333333, 174.333333333333, 225.333333333333, 
                      212.416666666667, 169.75, 182.083333333333, 183.25, 180, 173.5, 
                      182.916666666667, 196.666666666667, 188.75, 208.5, 210.666666666667, 
                      200.916666666667, 171.166666666667, 185.333333333333, 198.833333333333, 
                      205, 177.666666666667, 174.166666666667, -153.916666666667, 
                      193.583333333333, 195.666666666667, 202.666666666667, 200.416666666667, 
                      207.583333333333, 209.916666666667, 179, 181.166666666667, 193, 187.75, 
                      184.75, 198.333333333333, 203.166666666667, 194.916666666667, 192.75, 
                      194.916666666667, 187.333333333333, 215.25, 231.25, 228.5, 
                      119.416666666667, 117.333333333333, 128.666666666667, 134.666666666667, 
                      141.5, 122.5, 127.083333333333, 123.75, 115.583333333333, 
                      164.833333333333, 116.833333333333, 141.5, 155.333333333333, 
                      158.916666666667, 122.916666666667, 114.083333333333, 150.083333333333, 
                      156.833333333333, 150.583333333333, -115.25, 173.583333333333, 
                      172.666666666667, 152.833333333333, 141.916666666667, 109.666666666667, 
                      110.833333333333, 119.083333333333, 109.333333333333, 131.333333333333, 
                      128.416666666667, 116.75, 117.083333333333, 121.25, 118, 110.5, 
                      114.916666666667, 128.666666666667, 122.75, 146.5, 136.666666666667, 
                      143.916666666667, 122.166666666667, 116.333333333333, 129.833333333333, 
                      141, 106.666666666667, 117.166666666667, -98.9166666666667, 
                      126.583333333333, 119.666666666667, 129.666666666667, 122.416666666667, 
                      137.583333333333, 127.916666666667, 121, 122.166666666667, 125, 124.75, 
                      115.75, 133.333333333333, 130.166666666667, 127.916666666667, 123.75, 
                      127.916666666667, 117.333333333333, 140.25, 158.25, 154.5, 
                      28.4166666666667, 53.3333333333333, 63.6666666666667, 62.6666666666667, 
                      55.5, 55.5, 59.0833333333333, 53.75, 57.5833333333333, 72.8333333333333,
                      56.8333333333333, 64.5, 70.3333333333333, 63.9166666666667, 
                      51.9166666666667, 59.0833333333333, 86.0833333333333, 72.8333333333333, 
                      77.5833333333333, -31.25, 71.5833333333333, 80.6666666666667, 
                      60.8333333333333, 65.9166666666667, 53.6666666666667, 53.8333333333333, 
                      46.0833333333333, 51.3333333333333, 44.3333333333333, 45.4166666666667, 
                      63.75, 66.0833333333333, 50.25, 66, 50.5, 34.9166666666667, 
                      52.6666666666667, 46.75, 76.5, 68.6666666666667, 61.9166666666667, 
                      63.1666666666667, 57.3333333333333, 55.8333333333333, 50, 
                      53.6666666666667, 57.1666666666667, -34.9166666666667, 56.5833333333333,
                      54.6666666666667, 71.6666666666667, 59.4166666666667, 70.5833333333333, 
                      44.9166666666667, 57, 67.1666666666667, 63, 63.75, 55.75, 
                      49.3333333333333, 54.1666666666667, 46.9166666666667, 54.75, 
                      62.9166666666667, 61.3333333333333, 66.25, 74.25, 74.5, 
                      10.4166666666667, 2.33333333333331, 10.6666666666667, 7.66666666666668, 
                      10.5, 20.5, 10.0833333333333, 10.75, 8.58333333333332, 16.8333333333333,
                      -3.16666666666669, -9.5, 0.333333333333314, -12.0833333333333, 
                      4.91666666666669, 5.08333333333331, 2.08333333333331, 9.83333333333332, 
                      3.58333333333331, 3.75, 28.5833333333333, 15.6666666666667, 
                      -6.16666666666668, -7.08333333333332, 3.66666666666669, 
                      4.83333333333331, -1.91666666666669, -3.66666666666669, 
                      0.333333333333314, 8.41666666666668, 12.75, 2.08333333333331, 5.25, 5, 
                      -2.5
                      , -2.08333333333331, 14.6666666666667, 1.75, -7.5, -1.33333333333331, 
                      -7.08333333333332, 7.16666666666668, 2.33333333333331, 10.8333333333333,
                      2, 6.66666666666668, 11.1666666666667, -0.916666666666686, 
                      -3.41666666666669, -4.33333333333331, 5.66666666666668, 
                      21.4166666666667, 13.5833333333333, -5.08333333333331, 4, 
                      -2.83333333333331, -5, 7.75, 7.75, -5.66666666666668, 0.166666666666686,
                      4.91666666666669, 19.75, 0.916666666666686, 6.33333333333332, 2.25, 
                      -19.75, -7.5, -21.5833333333333, -42.6666666666667, -51.3333333333333, 
                      -46.3333333333333
                      , -45.5, -57.5, -22.9166666666667, -23.25, -51.4166666666667, 
                      -44.1666666666667, -39.1666666666667, -48.5, -38.6666666666667, 
                      -42.0833333333333, -32.0833333333333, -27.9166666666667, 
                      -43.9166666666667, -42.1666666666667, -46.4166666666667, 68.75, 
                      -38.4166666666667, -39.3333333333333, -33.1666666666667, 
                      -27.0833333333333, -33.3333333333333, -40.1666666666667, 
                      -21.9166666666667, -25.6666666666667, -43.6666666666667, 
                      -38.5833333333333, -38.25, -40.9166666666667, -44.75, -35, -44.5, 
                      -38.0833333333333, -37.3333333333333, -42.25, -56.5, -56.3333333333333, 
                      -40.0833333333333
                      , -40.8333333333333, -41.6666666666667, -35.1666666666667, -44, 
                      -38.3333333333333, -44.8333333333333, 43.0833333333333, 
                      -31.4166666666667, -44.3333333333333, -44.3333333333333, 
                      -46.5833333333333, -37.4166666666667, -42.0833333333333, -30, 
                      -29.8333333333333, -33, -42.25, -48.25, -31.6666666666667, 
                      -36.8333333333333, -49.0833333333333, -50.25, -31.0833333333333, 
                      -40.6666666666667, -51.75, -38.75, -38.5, -94.5833333333333, 
                      -121.666666666667, -129.333333333333, -122.333333333333, -133.5, -152.5,
                      -110.916666666667, -108.25, -127.416666666667, -143.166666666667, 
                      -111.166666666667, -132.5, -110.666666666667, -158.083333333333, 
                      -115.083333333333, -115.916666666667, -128.916666666667, 
                      -121.166666666667, -126.416666666667, 138.75, -150.416666666667, 
                      -145.333333333333, -126.166666666667, -121.083333333333, 
                      -104.333333333333, -111.166666666667, -91.9166666666667, 
                      -91.6666666666667, -119.666666666667, -128.583333333333, -99.25, 
                      -111.916666666667, -111.75, -105, -104.5, -99.0833333333333, 
                      -115.333333333333, -114.25, -139.5, -132.333333333333, 
                      -126.083333333333, -117.833333333333, -117.666666666667, 
                      -115.166666666667, -123, -111.333333333333, -113.833333333333, 
                      128.083333333333, -118.416666666667, -118.333333333333, 
                      -119.333333333333, -134.583333333333, -132.416666666667, 
                      -121.083333333333, -97, -98.8333333333333, -119, -117.25, -121.25, 
                      -122.666666666667, -125.833333333333, -123.083333333333, -127.25, 
                      -113.083333333333, -113.666666666667, -127.75, -123.75, -134.5, 
                      -149.583333333333, -163.666666666667, -165.333333333333, 
                      -169.333333333333, -206.5, -192.5, -162.916666666667, -164.25, 
                      -170.416666666667, -217.166666666667, -150.166666666667, -201.5, 
                      -172.666666666667, -235.083333333333, -187.083333333333, 
                      -176.916666666667, -194.916666666667, -200.166666666667, 
                      -192.416666666667, 197.75, -226.416666666667, -215.333333333333, 
                      -196.166666666667, -209.083333333333, -157.333333333333, 
                      -155.166666666667, -153.916666666667, -146.666666666667, 
                      -190.666666666667, -189.583333333333, -143.25, -157.916666666667, 
                      -167.75, -158, -161.5, -170.083333333333, -170.333333333333, -177.25, 
                      -188.5, -195.333333333333, -175.083333333333, -167.833333333333, 
                      -162.666666666667, -172.166666666667, -187, -158.333333333333, 
                      -158.833333333333, 188.083333333333, -179.416666666667, 
                      -175.333333333333, -189.333333333333, -191.583333333333, 
                      -184.416666666667, -178.083333333333, -161, -160.833333333333, -188, 
                      -173.25, -179.25, -185.666666666667, -185.833333333333, 
                      -173.083333333333, -175.25, -179.083333333333, -178.666666666667, 
                      -187.75, -193.75, -196.5, -151.583333333333, -145.666666666667, 
                      -147.333333333333, -139.333333333333, -180.5, -160.5, -135.916666666667,
                      -160.25, -149.416666666667, -189.166666666667, -138.166666666667, 
                      -174.5, -163.666666666667, -209.083333333333, -159.083333333333, 
                      -165.916666666667, -182.916666666667, -201.166666666667, 
                      -168.416666666667, 174.75, -228.416666666667, -222.333333333333, 
                      -181.166666666667, -192.083333333333, -138.333333333333, 
                      -139.166666666667, -148.916666666667, -145.666666666667, 
                      -186.666666666667, -175.583333333333, -145.25, -132.916666666667, 
                      -146.75, -157, -144.5, -160.083333333333, -153.333333333333, -157.25, 
                      -165.5, -165.333333333333, -148.083333333333, -153.833333333333, 
                      -147.666666666667, -162.166666666667, -173, -150.333333333333, 
                      -146.833333333333, 172.083333333333, -163.416666666667, 
                      -172.333333333333, -176.333333333333, -171.583333333333, 
                      -168.416666666667, -158.083333333333, -148, -142.833333333333, -160, 
                      -161.25, -170.25, -166.666666666667, -171.833333333333, 
                      -153.083333333333, -155.25, -168.083333333333, -152.666666666667, 
                      -165.75, -174.75, -171.5, -102.583333333333, -93.6666666666667, 
                      -116.333333333333, -112.333333333333, -118.5, -111.5, -122.916666666667,
                      -126.25, -104.416666666667, -138.166666666667, -103.166666666667, 
                      -116.5, -136.666666666667, -128.083333333333, -115.083333333333, 
                      -113.916666666667, -137.916666666667, -136.166666666667, 
                      -125.416666666667, 55.75, -157.416666666667, -158.333333333333, 
                      -147.166666666667, -152.083333333333, -95.3333333333333, 
                      -94.1666666666667, -101.916666666667, -104.666666666667, 
                      -107.666666666667, -142.583333333333, -103.25, -106.916666666667, 
                      -110.75, -115, -105.5, -128.083333333333, -116.333333333333, -126.25, 
                      -120.5, -106.333333333333, -117.083333333333, -100.833333333333, 
                      -100.666666666667, -123.166666666667, -135, -116.333333333333, 
                      -110.833333333333, 56.0833333333333, -116.416666666667, 
                      -107.333333333333, -127.333333333333, -131.583333333333, 
                      -138.416666666667, -130.083333333333, -101, -115.833333333333, -107, 
                      -110.25, -120.25, -121.666666666667, -122.833333333333, 
                      -116.083333333333, -123.25, -129.083333333333, -114.666666666667, 
                      -139.75, -138.75, -138.5), .Dim = c(68, 12), .Dimnames = list(c("1L", 
                                                                                      "1R", "11R", "18R", "28L", "28R", "176L", "176R", "204R", "215L", 
                                                                                      "234L", "266L", "278L", "372L", "380L", "380R", "404L", "404R", "416R", 
                                                                                      "605L", "653L", "653R", "657L", "657R", "675L", "675R", "717L", "717R", 
                                                                                      "740L", "740R", "764R", "771L", "771R", "788R", "809L", "809R", "851L", 
                                                                                      "851R", "1020L", "1020R", "1053L", "1262L", "1262R", "1297L", "1362R", 
                                                                                      "1390L", "1390R", "1450L", "1508L", "1508R", "1651L", "1651R", "1707R", 
                                                                                      "1871R", "1922L", "1922R", "1945L", "2283L", "2283R", "2583L", "2583R", 
                                                                                      "2676L", "2676R", "2700L", "2700R", "2711R", "2714L", "2714R"), c("x1", 
                                                                                                                                                        "x2", "x3", "x4", "x5", "x6", "x7", "x8", "x9", "x10", "x11", "x12")))
"landy"<-
  structure(.Data = c(128.5, 128.25, 145.166666666667, 148.416666666667, 149.75, 
                      145.5, 146.25, 157.333333333333, 130.25, 146.666666666667, 
                      135.833333333333, 153.333333333333, 158.5, 185, 138.5, 144.833333333333,
                      163.833333333333, 168.666666666667, 168.916666666667, 138.75, 
                      173.083333333333, 182.25, 158.583333333333, 166.833333333333, 
                      116.666666666667, 117.583333333333, 130.833333333333, 132.416666666667, 
                      150, 151, 142.333333333333, 126.083333333333, 134.583333333333, 135.5, 
                      129.416666666667, 134.666666666667, 143.416666666667, 149.416666666667, 
                      162.416666666667, 156.916666666667, 138.5, 129.75, 141.333333333333, 
                      149.75, 168.916666666667, 124.416666666667, 129.416666666667, 
                      157.166666666667, 155.5, 160.833333333333, 104.416666666667, 153.5, 
                      146.333333333333, 126.5, 138.666666666667, 141.75, 154.583333333333, 
                      158.333333333333, 157.25, 140.916666666667, 147, 146.75, 142.25, 
                      147.583333333333, 141.833333333333, 155.25, 156.916666666667, 
                      164.083333333333, 133.5, 143.25, 153.166666666667, 148.416666666667, 
                      164.75, 158.5, 169.25, 178.333333333333, 149.25, 173.666666666667, 
                      151.833333333333, 161.333333333333, 170.5, 202, 165.5, 164.833333333333,
                      174.833333333333, 180.666666666667, 175.916666666667, 170.75, 
                      172.083333333333, 185.25, 179.583333333333, 189.833333333333, 
                      120.666666666667, 130.583333333333, 145.833333333333, 142.416666666667, 
                      180, 177, 148.333333333333, 136.083333333333, 153.583333333333, 145.5, 
                      149.416666666667, 145.666666666667, 161.416666666667, 164.416666666667, 
                      175.416666666667, 173.916666666667, 152.5, 143.75, 149.333333333333, 
                      160.75, 175.916666666667, 143.416666666667, 142.416666666667, 
                      167.166666666667, 167.5, 168.833333333333, 173.416666666667, 154.5, 
                      169.333333333333, 157.5, 155.666666666667, 153.75, 166.583333333333, 
                      158.333333333333, 141.25, 163.916666666667, 169, 151.75, 147.25, 
                      144.583333333333, 147.833333333333, 172.25, 188.916666666667, 
                      182.083333333333, 43.5, 29.25, 31.1666666666667, 41.4166666666667, 
                      35.75, 27.5, 42.25, 46.3333333333333, 22.25, 51.6666666666667, 
                      33.8333333333333, 21.3333333333333, 45.5, 34, 35.5, 31.8333333333333, 
                      47.8333333333333, 60.6666666666667, 53.9166666666667, 7.75, 
                      48.0833333333333, 44.25, 49.5833333333333, 42.8333333333333, 
                      32.6666666666667, 24.5833333333333, 27.8333333333333, 29.4166666666667, 
                      58, 37, 33.3333333333333, 40.0833333333333, 25.5833333333333, 30.5, 
                      32.4166666666667, 20.6666666666667, 44.4166666666667, 24.4166666666667, 
                      30.4166666666667, 34.9166666666667, 32.5, 29.75, 23.3333333333333, 
                      45.75, 36.9166666666667, 26.4166666666667, 22.4166666666667, 
                      10.1666666666667, 33.5, 28.8333333333333, 39.4166666666667, 16.5, 
                      37.3333333333333, 27.5, 35.6666666666667, 38.75, 26.5833333333333, 
                      44.3333333333333, 22.25, 32.9166666666667, 34, 32.75, 21.25, 
                      29.5833333333333, 23.8333333333333, 30.25, 52.9166666666667, 
                      28.0833333333333, -46.5, -56.75, -54.8333333333333, -51.5833333333333, 
                      -53.25
                      , -67.5, -50.75, -56.6666666666667, -67.75, -54.3333333333333, 
                      -61.1666666666667, -76.6666666666667, -50.5, -81, -62.5, 
                      -70.1666666666667, -57.1666666666667, -53.3333333333333, 
                      -59.0833333333333, -78.25, -61.9166666666667, -66.75, -58.4166666666667,
                      -79.1666666666667, -52.3333333333333, -52.4166666666667, 
                      -58.1666666666667, -65.5833333333333, -66, -69, -56.6666666666667, 
                      -64.9166666666667, -61.4166666666667, -58.5, -67.5833333333333, 
                      -70.3333333333333, -50.5833333333333, -66.5833333333333, 
                      -74.5833333333333, -69.0833333333333, -58.5, -57.25, -70.6666666666667, 
                      -59.25
                      , -57.0833333333333, -73.5833333333333, -56.5833333333333, 
                      -68.8333333333333, -64.5, -70.1666666666667, -64.5833333333333, -75.5, 
                      -63.6666666666667
                      , -66.5, -55.3333333333333, -56.25, -82.4166666666667, 
                      -64.6666666666667, -68.75, -66.0833333333333, -62, -57.25, -74.75, 
                      -68.4166666666667, -67.1666666666667, -65.75, -68.0833333333333, 
                      -82.9166666666667, -120.5, -121.75, -123.833333333333, 
                      -133.583333333333, -127.25, -127.5, -127.75, -135.666666666667, -121.75,
                      -135.333333333333, -133.166666666667, -145.666666666667, -141.5, -168, 
                      -134.5
                      , -138.166666666667, -141.166666666667, -140.333333333333, 
                      -151.083333333333, -136.25, -149.916666666667, -152.75, 
                      -152.416666666667, -156.166666666667, -114.333333333333, 
                      -112.416666666667, -123.166666666667, -123.583333333333, -133, -131, 
                      -118.666666666667, -135.916666666667, -128.416666666667, -126.5, 
                      -122.583333333333, -119.333333333333, -130.583333333333, 
                      -129.583333333333, -144.583333333333, -145.083333333333, -134.5, 
                      -131.25, -132.666666666667, -136.25, -123.083333333333, 
                      -115.583333333333, -115.583333333333, -126.833333333333, -135.5, 
                      -131.166666666667, -136.583333333333, -133.5, -143.666666666667, -123.5,
                      -124.333333333333, -130.25, -151.416666666667, -130.666666666667, 
                      -124.75, -137.083333333333, -137, -121.25, -116.75, -129.416666666667, 
                      -127.166666666667
                      , -137.75, -152.083333333333, -156.916666666667, -48.5, -53.75, 
                      -66.8333333333333, -63.5833333333333, -91.25, -77.5, -74.75, 
                      -75.6666666666667, -60.75, -93.3333333333333, -41.1666666666667, 
                      -55.6666666666667, -68.5, -78, -72.5, -57.1666666666667, 
                      -54.1666666666667, -79.3333333333333, -69.0833333333333, -71.25, 
                      -92.9166666666667, -71.75, -64.4166666666667, -58.1666666666667, 
                      -48.3333333333333, -43.4166666666667, -69.1666666666667, 
                      -41.5833333333333, -108, -93, -67.6666666666667, -59.9166666666667, 
                      -61.4166666666667, -36.5, -66.5833333333333, -74.3333333333333, 
                      -85.5833333333333, -75.5833333333333, -47.5833333333333, 
                      -54.0833333333333, -65.5, -51.25, -53.6666666666667, -75.25, 
                      -91.0833333333333, -60.5833333333333, -64.5833333333333, 
                      -71.8333333333333, -76.5, -56.1666666666667, -43.5833333333333, -61.5, 
                      -54.6666666666667
                      , -56.5, -67.3333333333333, -47.25, -50.4166666666667, 
                      -67.6666666666667, -69.75, -77.0833333333333, -72, -86.25, -74.75, 
                      -37.4166666666667, -44.1666666666667, -61.75, -54.0833333333333, 
                      -31.9166666666667, 2.5, -0.75, -0.833333333333314, 11.4166666666667, 
                      -7.25, -7.5, -14.75, -0.666666666666686, 11.25, 5.66666666666668, 
                      14.8333333333333, 27.3333333333333, 2.5, 16, 14.5, 9.83333333333332, 
                      -11.1666666666667, -15.3333333333333, 3.91666666666669, 25.75, 
                      35.0833333333333, 33.25, 18.5833333333333, 31.8333333333333, 
                      3.66666666666669, 8.58333333333332, 26.8333333333333, 25.4166666666667, 
                      2, 4, 9.33333333333332, 3.08333333333331, 15.5833333333333, 23.5, 
                      6.41666666666668, 6.66666666666668, 2.41666666666669, 7.41666666666668, 
                      4.41666666666669, 1.91666666666669, 22.5, 30.75, 22.3333333333333, 
                      11.75, -16.0833333333333, 17.4166666666667, 9.41666666666668, 
                      5.16666666666669, 21.5, 7.83333333333332, 25.4166666666667, 9.5, 
                      20.3333333333333, 17.5, 7.66666666666668, 3.75, 37.5833333333333, 
                      1.33333333333331, 11.25, 39.9166666666667, 27, 5.75, 7.25, 
                      12.5833333333333, 10.8333333333333, 11.25, 14.9166666666667, 
                      20.0833333333333, -70.5, -79.75, -98.8333333333333, -79.5833333333333, 
                      -86.25
                      , -76.5, -86.75, -94.6666666666667, -77.75, -81.3333333333333, 
                      -78.1666666666667, -63.6666666666667, -88.5, -113, -76.5, 
                      -96.1666666666667, -90.1666666666667, -102.333333333333, 
                      -99.0833333333333, -49.25, -87.9166666666667, -94.75, -93.4166666666667,
                      -94.1666666666667, -63.3333333333333, -74.4166666666667, 
                      -54.1666666666667, -67.5833333333333, -85, -88, -75.6666666666667, 
                      -91.9166666666667, -75.4166666666667, -64.5, -62.5833333333333, 
                      -62.3333333333333, -69.5833333333333, -74.5833333333333, 
                      -89.5833333333333, -96.0833333333333, -69.5, -66.25, -78.6666666666667, 
                      -83.25
                      , -97.0833333333333, -56.5833333333333, -80.5833333333333, 
                      -87.8333333333333, -75.5, -102.166666666667, -66.5833333333333, -70.5, 
                      -83.6666666666667
                      , -74.5, -69.3333333333333, -82.25, -73.4166666666667, 
                      -82.6666666666667, -80.75, -75.0833333333333, -90, -70.25, -73.75, 
                      -78.4166666666667, -78.1666666666667, -95.75, -101.083333333333, 
                      -94.9166666666667, -122.5, -119.75, -125.833333333333, 
                      -134.583333333333, -134.25, -126.5, -127.75, -134.666666666667, -121.75,
                      -136.333333333333, -133.166666666667, -144.666666666667, -139.5, -175, 
                      -133.5
                      , -134.166666666667, -144.166666666667, -140.333333333333, 
                      -151.083333333333, -133.25, -159.916666666667, -157.75, 
                      -155.416666666667, -155.166666666667, -111.333333333333, 
                      -111.416666666667, -122.166666666667, -126.583333333333, -136, -128, 
                      -120.666666666667, -136.916666666667, -126.416666666667, -126.5, 
                      -119.583333333333, -108.333333333333, -132.583333333333, 
                      -130.583333333333, -148.583333333333, -147.083333333333, -136.5, 
                      -131.25, -132.666666666667, -136.25, -127.083333333333, 
                      -115.583333333333, -116.583333333333, -131.833333333333, -137.5, 
                      -132.166666666667, -134.583333333333, -131.5, -144.666666666667, -122.5,
                      -119.333333333333, -124.25, -149.416666666667, -130.666666666667, 
                      -122.75, -142.083333333333, -139, -122.25, -116.75, -124.416666666667, 
                      -130.166666666667
                      , -139.75, -158.083333333333, -153.916666666667, -65.5, -50.75, 
                      -57.8333333333333, -60.5833333333333, -66.25, -47.5, -58.75, 
                      -78.6666666666667, -56.75, -76.3333333333333, -67.1666666666667, 
                      -75.6666666666667, -79.5, -81, -79.5, -70.1666666666667, 
                      -87.1666666666667, -85.3333333333333, -73.0833333333333, -63.25, 
                      -91.9166666666667, -101.75, -84.4166666666667, -92.1666666666667, 
                      -54.3333333333333, -57.4166666666667, -70.1666666666667, 
                      -75.5833333333333, -72, -74, -66.6666666666667, 28.0833333333333, 
                      -63.4166666666667, -81.5, -60.5833333333333, -63.3333333333333, 
                      -69.5833333333333, -69.5833333333333, -71.5833333333333, 
                      -68.0833333333333, -64.5, -66.25, -61.6666666666667, -72.25, 
                      -67.0833333333333, -55.5833333333333, -53.5833333333333, 
                      -58.8333333333333, -74.5, -68.1666666666667, -74.5833333333333, -69.5, 
                      -72.6666666666667
                      , -62.5, -73.3333333333333, -67.25, -77.4166666666667, 
                      -72.6666666666667, -64.75, -75.0833333333333, -75, -63.25, -56.75, 
                      -73.4166666666667, -66.1666666666667, -64.75, -80.0833333333333, 
                      -77.9166666666667, 11.5, 25.25, 27.1666666666667, 16.4166666666667, 
                      29.75, 28.5, 18.25, 14.3333333333333, 25.25, 16.6666666666667, 
                      13.8333333333333, 20.3333333333333, 2.5, 35, 19.5, 28.8333333333333, 
                      5.83333333333332, 18.6666666666667, 15.9166666666667, 32.75, 
                      15.0833333333333, -0.75, 11.5833333333333, 10.8333333333333, 
                      22.6666666666667, 19.5833333333333, 12.8333333333333, 9.41666666666668, 
                      27, 22, 12.3333333333333, 10.0833333333333, 25.5833333333333, 2.5, 
                      18.4166666666667, 20.6666666666667, 15.4166666666667, 17.4166666666667, 
                      12.4166666666667, 24.9166666666667, 18.5, 15.75, 25.3333333333333, 
                      16.75, 16.9166666666667, 11.4166666666667, 23.4166666666667, 
                      34.1666666666667, 14.5, 19.8333333333333, 11.4166666666667, 23.5, 
                      16.3333333333333, 17.5, 9.66666666666668, 8.75, 14.5833333333333, 
                      14.3333333333333, 23.25, 13.9166666666667, 15, 14.75, 21.25, 
                      3.58333333333331, 19.8333333333333, 17.25, 12.9166666666667, 
                      15.0833333333333, 154.5, 157.25, 172.166666666667, 157.416666666667, 
                      185.75, 170.5, 165.25, 180.333333333333, 168.25, 182.666666666667, 
                      163.833333333333, 178.333333333333, 188.5, 224, 185.5, 185.833333333333,
                      192.833333333333, 187.666666666667, 183.916666666667, 155.75, 
                      201.083333333333, 201.25, 190.583333333333, 192.833333333333, 
                      147.666666666667, 150.583333333333, 152.833333333333, 161.416666666667, 
                      183, 192, 160.333333333333, 146.083333333333, 161.583333333333, 156.5, 
                      163.416666666667, 169.666666666667, 171.416666666667, 183.416666666667, 
                      191.416666666667, 186.916666666667, 164.5, 153.75, 168.333333333333, 
                      177.75, 179.916666666667, 154.416666666667, 160.416666666667, 
                      172.166666666667, 171.5, 173.833333333333, 166.416666666667, 184.5, 
                      173.333333333333, 159.5, 161.666666666667, 160.75, 184.583333333333, 
                      172.333333333333, 176.25, 180.916666666667, 183, 168.75, 174.25, 
                      173.583333333333, 168.833333333333, 179.25, 186.916666666667, 
                      189.083333333333), .Dim = c(68, 12), .Dimnames = list(c("1L", "1R", 
                                                                              "11R", "18R", "28L", "28R", "176L", "176R", "204R", "215L", "234L", 
                                                                              "266L", "278L", "372L", "380L", "380R", "404L", "404R", "416R", "605L", 
                                                                              "653L", "653R", "657L", "657R", "675L", "675R", "717L", "717R", "740L", 
                                                                              "740R", "764R", "771L", "771R", "788R", "809L", "809R", "851L", "851R", 
                                                                              "1020L", "1020R", "1053L", "1262L", "1262R", "1297L", "1362R", "1390L", 
                                                                              "1390R", "1450L", "1508L", "1508R", "1651L", "1651R", "1707R", "1871R", 
                                                                              "1922L", "1922R", "1945L", "2283L", "2283R", "2583L", "2583R", "2676L", 
                                                                              "2676R", "2700L", "2700R", "2711R", "2714L", "2714R"), c("y1", "y2", 
                                                                                                                                       "y3", "y4", "y5", "y6", "y7", "y8", "y9", "y10", "y11", "y12")))
"ebl"<-
  structure(.Data = c(T, T, F, F, F, F, F, F, F, F, F, F, T, F, F, F, F, T, F, F, 
                      T, T, T, T, F, F, F, F, T, F, F, F, F, F, F, T, F, F, F, F, F, F, F, F, 
                      T, F, F, T, F, F, F, T, F, T, F, F, F, F, T, F, F, F, T, F, F, F, F, F),
            .Names = c("1L", "1R", "11R", "18R", "28L", "28R", "176L", "176R", 
                       "204R", "215L", "234L", "266L", "278L", "372L", "380L", "380R", "404L", 
                       "404R", "416R", "605L", "653L", "653R", "657L", "657R", "675L", "675R", 
                       "717L", "717R", "740L", "740R", "764R", "771L", "771R", "788R", "809L", 
                       "809R", "851L", "851R", "1020L", "1020R", "1053L", "1262L", "1262R", 
                       "1297L", "1362R", "1390L", "1390R", "1450L", "1508L", "1508R", "1651L", 
                       "1651R", "1707R", "1871R", "1922L", "1922R", "1945L", "2283L", "2283R", 
                       "2583L", "2583R", "2676L", "2676R", "2700L", "2700R", "2711R", "2714L", 
                       "2714R"))

bones=list()
total = cbind(landx, landy, ebl)
ebu = c()
eburnated = array(0, dim = c(12,2, 16))
noneburnated = array(0,dim = c(12,2,52))
j=1; k=1
cc = c()
for(i in 1:68){
  bones[[i]] = assign(paste("bone", i, sep = ""), 
                      as.matrix(cbind(landx[i,], landy[i,])))
  if(total[i,25]==1){
    eburnated[,,j] = bones[[i]]
    j = j+1
    ebu[i] = "1"
    cc = cbind(cc, i)
  }
  else{
    noneburnated[,,k] = bones[[i]]
    k = k+1
    ebu[i] = "0"
  }
  
}
ebu = as.factor(ebu)

########################## FDA ##########################

# So in the paper they extend the data to 100 equidistant points along the shape of the bone
# I approximated this with 96 points, adding the miss points in a straight line b/t landmarks




newx = matrix(NA, 68, 96)
newy = matrix(NA, 68, 96)
for(i in 1:68){
  x1 = seq(landx[i,1], landx[i,2], length.out = 9)
  x2 = seq(landx[i,2], landx[i,3], length.out = 9)
  x3 = seq(landx[i,3], landx[i,4], length.out = 9)
  x4 = seq(landx[i,4], landx[i,5], length.out = 9)
  x5 = seq(landx[i,5], landx[i,6], length.out = 9)
  x6 = seq(landx[i,6], landx[i,7], length.out = 9)
  x7 = seq(landx[i,7], landx[i,8], length.out = 9)
  x8 = seq(landx[i,8], landx[i,9], length.out = 9)
  x9 = seq(landx[i,9], landx[i,10], length.out = 9)
  x10 = seq(landx[i,10], landx[i,11], length.out = 9)
  x11 = seq(landx[i,11], landx[i,12], length.out = 9)
  x12 = seq(landx[i,12], landx[i,1], length.out = 9)
  y1 = seq(landy[i,1], landy[i,2], length.out = 9)
  y2 = seq(landy[i,2], landy[i,3], length.out = 9)
  y3 = seq(landy[i,3], landy[i,4], length.out = 9)
  y4 = seq(landy[i,4], landy[i,5], length.out = 9)
  y5 = seq(landy[i,5], landy[i,6], length.out = 9)
  y6 = seq(landy[i,6], landy[i,7], length.out = 9)
  y7 = seq(landy[i,7], landy[i,8], length.out = 9)
  y8 = seq(landy[i,8], landy[i,9], length.out = 9)
  y9 = seq(landy[i,9], landy[i,10], length.out = 9)
  y10 = seq(landy[i,10], landy[i,11], length.out = 9)
  y11 = seq(landy[i,11], landy[i,12], length.out = 9)
  y12 = seq(landy[i,12], landy[i,1], length.out = 9)
  newx[i,] = c(x1[1:8],x2[1:8],x3[1:8], x4[1:8], x5[1:8], x6[1:8], x7[1:8], x8[1:8], 
               x9[1:8], x10[1:8], x11[1:8], x12[1:8])
  newy[i,] = c(y1[1:8], y2[1:8], y3[1:8], y4[1:8], y5[1:8], y6[1:8], y7[1:8], y8[1:8], 
               y9[1:8], y10[1:8], y11[1:8], y12[1:8])
}



# First transform all the data into a series of functions


# This data includes an additional 7 points in a straight line between each of the 
# original data points
landa <- array(c(t(newx),t(newy)), dim=c(96,68,2),
               dimnames=list((1:96),dimnames(landx)[[1]],c("x","y")))

bonestime = seq(0,1, len = 96)

# This is with just the data point actually measured on the bones
landa = array(c(t(landx),t(landy)), dim=c(12,68,2),
              dimnames=list((1:12),dimnames(landx)[[1]],c("x","y")))

bonestime = seq(0,1,len=12)

quartz()
par(mfrow=c(1,1),mar = c(4, 4, 2, 2))
matplot(bonestime,landa[,,1],type='l',cex.lab=1.5,cex.axis=1.5,ylab='X',xlab="t")
quartz()
par(mfrow=c(1,1),mar = c(4, 4, 2, 2))
matplot(bonestime,landa[,,2],type='l',cex.lab=1.5,cex.axis=1.5,ylab='Y',xlab="t")

quartz()
par(mfrow=c(1,1),mar = c(8, 8, 4, 2))
matplot(landa[,,1],landa[,,2],type='l',cex.lab=1.5,cex.axis=1.5,xlab='X',ylab='Y')


# Setting up a general object

# define the harmonic acceleration differential operator
harmaccelLfd <- vec2Lfd(c(0, 0, (2*pi)^2, 0))
# Must be an odd number
# bonesbasis51 <- create.fourier.basis(nbasis=95, period = 1)
bonesbasis51 = create.bspline.basis(1, norder = 11)

# Smooth the bones data
bonesfd <- smooth.basisPar(bonestime, landa,
                           bonesbasis51)$fd

# eval.basis(bonestime, bonesbasis51)


# bonesfd <- smooth.basisPar(bonestime, landa,
                           # bonesbasis51, Lfdobj=harmaccelLfd, lambda=1e-11)$fd
# I need to figure out how to make the curve 100 equidistance points that we arre analyzing
# so that the smoothing is just a function of the data

names(bonesfd$fdnames) = c("Landmark", "Bone", "Position")
bonesfd$fdnames[[3]] = c("X", "Y")

tfine = seq(0,1,0.01)
bonesvals = eval.fd(tfine,bonesfd)
quartz()
par(mfrow=c(1,1),mar = c(8, 8, 4, 2))
matplot(bonesvals[,,1],bonesvals[,,2],type='l',cex.lab=1.5,cex.axis=1.5,xlab='X',ylab='Y')

bones.cor = cor.fd(tfine,bonesfd)
dim(bones.cor)

# quartz()
# par(mfrow=c(1,3),mar = c(8, 8, 4, 2))
#  # contour(tfine,tfine,gait.cor[,,1,3],xlab='day',ylab='day',cex.lab=1.5,cex.axis=1.5)
# image.plot(tfine,tfine,bones.cor[,,1,1],bones.cor,
#            xlab='X',ylab='X',cex.lab=1.5,cex.axis=1.5)
# image.plot(tfine,tfine,bones.cor[,,1,2],bones.cor,
#            xlab='X',ylab='Y',cex.lab=1.5,cex.axis=1.5)
# image.plot(tfine,tfine,bones.cor[,,1,3],bones.cor,
#            xlab='Y',ylab='Y',cex.lab=1.5,cex.axis=1.5)



bones.pca = pca.fd(bonesfd,nharm=24)
quartz()
par(mfrow=c(2,1),mar = c(8, 8, 4, 2))
plot(bones.pca$meanfd,cex.lab=1.5,cex.axis=1.5)

quartz()
par(mfrow=c(1,1),mar = c(8, 8, 4, 2))
plot(bones.pca$values,cex.lab=1.5,cex.axis=1.5,xlab='PC',ylab='eigenvalue',col=4,cex=2)
bones.pca$varprop
sum(bones.pca$varprop)
# 
# 
# quartz()
# par(mfrow=c(1,2),mar = c(8, 8, 4, 2))
# plot(bones.pca$harmonics,lwd=2,cex.lab=1.5,cex.axis=1.5)

# It's not the sme as the paper, without guidance on how to create the additional 
# data points this is a poor approximation of their results, but still a guide of their 
# methods

quartz()
par(mfrow=c(2,2), mar = c(4,4,2,2))
plot.pca.fd(bones.pca, cycle = TRUE, harm = c(1,2,3,4))

bones.pca$harmonics[,1,]$coefs


eburnated_scores = bones.pca$scores[,,1][cc,]
non_eburnated_scores = bones.pca$scores[,,1][-cc,]

pvals = c()
for(i in 1:24){
  pvals[i] = t.test(eburnated_scores[,i], non_eburnated_scores[,i])$p.value
}
ps = data.frame(cbind(seq(1,24,by=1),pvals))
ps[order(ps$pvals),]

# In this example, we have our 5th, followed by the 17th principle components with the 
# most significant difference between bone types

quartz()
par(mfrow=c(1,2), mar = c(4,4,2,2))
plot.pca.fd(bones.pca, cycle = TRUE, harm = c(5,17))

# I chose the x PCs since we can observe that most of the variability is in the x-axis for the
# 5th, and it's fairly equal in the 17th

one_component = cbind(bones.pca$scores[,5,1], ebl)
total_one = as.data.frame(one_component)

one_c = lda(ebl~.,  total_one, CV = FALSE)
predict_one = predict(one_c, total_one)$class
confusionMatrix(ebu, predict_one)$table

# 13 misclassifications using the first and second principal component

two_component = cbind(bones.pca$scores[,c(5, 17),1], ebl)
total_two = as.data.frame(two_component)

two_c = lda(ebl~.,  total_two, CV = FALSE)
predict_two = predict(two_c, total_two)$class
confusionMatrix(predict_two, ebu)$table

# For comparison using the PCs for the y axis we get less

one_component = cbind(bones.pca$scores[,5,2], ebl)
total_one = as.data.frame(one_component)

one_c = lda(ebl~.,  total_one, CV = FALSE)
predict_one = predict(one_c, total_one)$class
confusionMatrix(ebu, predict_one)$table

# 16 for both

two_component = cbind(bones.pca$scores[,c(5, 17),2], ebl)
total_two = as.data.frame(two_component)

two_c = lda(ebl~.,  total_two, CV = FALSE)
predict_two = predict(two_c, total_two)$class
confusionMatrix(predict_two, ebu)$table



########################## ICA ##########################

# To start I choose the components 5, 6, 9, 13, 17, 18, 20 since they are 
# significantly different at alpha = 0.1. I chose a larger alpha since the smoothing 
# wasn't great for retaining the true shape of the data. Again, by looking at the plot of
# each of these we notice the majority of the variance occurs in the x-axis
# good_ones = c(5,9,17,6,20,13,18)


quartz()
par(mfrow=c(4,2), mar = c(4,4,2,2))
plot.pca.fd(bones.pca, cycle = TRUE, harm = good_ones)

bones_ica_1 = fastICA::fastICA(total, n.comp =1)
b_i_lda = as.data.frame(cbind(bones_ica_1$S, ebl)) # Must be in a data frame to run

# Large training set since there are very few eburnated bones
train = sample(1:68, 67)

two_c = lda(ebl[train]~., b_i_lda[train,])
predict_two = predict(two_c, b_i_lda)$class
confusionMatrix(predict_two, ebu)$table

# 6 right, 2 wrong, train = 60, test = 8
# 15 right, 3 wrong, train = 50, test = 18
# 22 right, 6 wrong, train = 40, test = 28

bones_ica_2 = fastICA::fastICA(total, n.comp =2)
b_i_lda = as.data.frame(cbind(bones_ica_2$S, ebl))
two_c = lda(ebl[train]~., b_i_lda[train,])
predict_two = predict(two_c, b_i_lda)$class
confusionMatrix(predict_two, ebu)$table

# Similar results with two components
# 5 right, 3 wrong, train = 60, test = 8
# 16 right, 2 wrong, train = 50, test = 18
# 16 right, 7 wrong, train = 40, test = 28

# These are not very encouraging results, I suspect it has something to do with the amount
# of smoothing that has taken place above

# Without training or testing data we get 16 misclassifications
# 16 misclassifications, but once again we have no test/training data so this is 
# possibly an underestimate, but certainly a huge problem when we know 16 are eburnated and
# all of the are false negatives


bones_ica_2 = fastICA::fastICA(dat, n.comp =2)
b_i_lda = as.data.frame(cbind(bones_ica_2$S, ebl))
two_c = lda(ebl~., b_i_lda)
predict_two = predict(two_c, b_i_lda)$class
confusionMatrix(predict_two, ebu)$table

# plot(bones_ica_1$X %*% bones_ica$K, main = "PCA Components")

pairs(bones_ica_1$S, col = rainbow(3)[b_i[,8]])
# plot(bones_ica_1$S, main = "ICA Components")
